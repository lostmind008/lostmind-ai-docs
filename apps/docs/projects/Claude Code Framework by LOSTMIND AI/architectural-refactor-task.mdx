---
title: "Architectural Refactor Task"
description: "documentation for Claude Code Framework by LOSTMIND AI"
category: "documentation"
project: "Claude Code Framework by LOSTMIND AI"
lastUpdated: "2025-09-21"
tags: "documentation,ai-services"
---

# Task: Fix LostMind AI Framework Architecture - Proper Claude Code Integration

## ğŸ¯ Mission
**CRITICAL**: The current PR violates Claude Code architectural principles. The framework must be a **system-level enhancement** that lives within the Claude Code ecosystem, not a user-managed project component that clutters project directories.

## ğŸš¨ Current Problems with PR #15

| **Issue** | **Current Wrong Approach** | **Impact** |
|-----------|---------------------------|------------|
| **Engine Location** | `lostmind_ai_engine/` in project directories | âŒ Pollutes projects with framework code |
| **Manual Path Management** | Users provide engine paths in commands | âŒ Breaks Claude Code UX paradigm |
| **Non-Standard Integration** | Framework acts like external tool | âŒ Doesn't feel like native Claude Code feature |
| **CLAUDE.md Location** | Inside `.claude/CLAUDE.md` | âŒ Violates official Claude Code documentation |

## âœ… Required Architecture (Based on Official Claude Code Documentation)

```
~/.claude/                              # GLOBAL Claude Code system directory
â”œâ”€â”€ lostmind_ai_engine/                # ğŸ¯ ENGINE LIVES HERE (system component)
â”‚   â”œâ”€â”€ context_guardian.py
â”‚   â”œâ”€â”€ run_engine.sh
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ [all engine files]
â”œâ”€â”€ commands/                          # Global UCF commands
â”‚   â”œâ”€â”€ ucf-onboard-project.md        # Auto-detects engine at ~/.claude/lostmind_ai_engine/
â”‚   â”œâ”€â”€ ucf-guardian-refresh.md       
â”‚   â”œâ”€â”€ ucf-create-task-brief.md
â”‚   â””â”€â”€ ucf-agent-create.md
â”œâ”€â”€ hooks/                             # Global hooks (optional)
â””â”€â”€ settings.json                      # Global settings

my-project/                            # User's actual project (CLEAN!)
â”œâ”€â”€ CLAUDE.md                          # ğŸ¯ PROJECT MEMORY (root level, not in .claude/)
â”œâ”€â”€ .claude/                           # Project-specific Claude Code settings only
â”‚   â”œâ”€â”€ hooks/                         # Project-specific hooks (if any)
â”‚   â”œâ”€â”€ agents/                        # Generated agents for this project
â”‚   â””â”€â”€ settings.json                  # Project-specific settings
â”œâ”€â”€ .lostmind_ai_context/              # Framework-generated context files
â””â”€â”€ src/                               # Actual project files
```

## ğŸ“‹ TASK BREAKDOWN

### Phase 1: Move Engine to Global Location âœ… REQUIRED

**1.1 Update Installation Script**
- [ ] Modify `install_lostmind_ai_framework.sh` to install engine to `~/.claude/lostmind_ai_engine/`
- [ ] Remove all references to user-provided engine paths
- [ ] Ensure engine is executable and properly permissioned

**1.2 Update Engine Detection Logic**
- [ ] All UCF commands must auto-detect engine at `~/.claude/lostmind_ai_engine/`
- [ ] Remove `$ARG1` (engine path) from all command files
- [ ] Add fallback error if engine not found in expected location

### Phase 2: Fix Command Interface âœ… REQUIRED

**2.1 Update UCF Command Files**

**Before (Wrong):**
```bash
# ucf-onboard-project.md
bash "$ARG1/run_engine.sh" onboard
```

**After (Correct):**
```bash
# ucf-onboard-project.md  
ENGINE_PATH="$HOME/.claude/lostmind_ai_engine"
if [ ! -f "$ENGINE_PATH/run_engine.sh" ]; then
    echo "âŒ LostMind AI engine not found. Please run the framework installer."
    exit 1
fi
bash "$ENGINE_PATH/run_engine.sh" onboard
```

**Commands to update:**
- [ ] `.claude/commands/ucf-onboard-project.md`
- [ ] `.claude/commands/ucf-create-task-brief.md`
- [ ] `.claude/commands/ucf-agent-create.md`
- [ ] `.claude/commands/ucf-guardian-refresh.md`
- [ ] `.claude/commands/ucf-guardian-status.md`
- [ ] `.claude/commands/ucf-export-chat.md`

**2.2 Update Command Descriptions**
- [ ] Remove all mentions of "provide engine path"
- [ ] Update argument hints to remove engine path parameters
- [ ] Simplify descriptions to reflect auto-detection

### Phase 3: Fix CLAUDE.md Placement âœ… REQUIRED

**3.1 Correct CLAUDE.md Location**
- [ ] Ensure CLAUDE.md is created in **PROJECT ROOT** (not inside `.claude/`)
- [ ] Update all onboarding scripts to create `./CLAUDE.md`
- [ ] Remove any logic creating `.claude/CLAUDE.md`

**3.2 Project Directory Structure**
```
project-root/
â”œâ”€â”€ CLAUDE.md                     # âœ… HERE (project memory)
â”œâ”€â”€ .claude/                      # Project-specific Claude Code config
â”‚   â”œâ”€â”€ agents/                  # Generated agents
â”‚   â””â”€â”€ settings.json            # Project settings (if needed)
â”œâ”€â”€ .lostmind_ai_context/        # Framework context files
â””â”€â”€ [actual project files]       # Clean project structure
```

### Phase 4: Update Installation Process âœ… REQUIRED

**4.1 Clean Installation Flow**
```bash
# User workflow should be:
git clone [repo]
cd [repo]
./install_lostmind_ai_framework.sh
cd .. && rm -rf [repo]  # Repository no longer needed!

# Then from any project:
cd ~/my-actual-project
/ucf-onboard-project  # Just works, no paths needed
```

**4.2 Installer Requirements**
- [ ] Install all components to `~/.claude/`
- [ ] Make engine globally accessible
- [ ] No project directory pollution
- 

---
*This content was automatically extracted from Claude Code Framework by LOSTMIND AI. For the most up-to-date information, refer to the source project.*
