---
title: "README"
description: "readme for ChatCrawler-Replit-version"
category: "readme"
project: "ChatCrawler-Replit-version"
lastUpdated: "2025-09-21"
tags: "readme,data-processing"
---

# Shared - Database Schema & Types

This directory contains the centralized database schema definitions, TypeScript types, and validation schemas shared between frontend and backend.

## Architecture

### Schema-First Design
- **Single Source of Truth**: All data models defined in one place
- **Type Safety**: Automatic TypeScript type generation
- **Validation**: Zod schemas for runtime validation
- **Database Sync**: Drizzle ORM for schema migrations

## Tech Stack

- **ORM**: Drizzle ORM with PostgreSQL adapter
- **Schema Definition**: Drizzle's declarative schema syntax
- **Type Generation**: Automatic TypeScript type inference
- **Validation**: Zod schemas with drizzle-zod integration
- **Migration**: Drizzle Kit for database schema management

## File Structure

```
shared/
├── README.md          # This documentation
├── schema.ts          # Main database schema definitions
└── prisma/           # Legacy Prisma files (deprecated)
    ├── schema.prisma  # Old schema (for reference)
    └── migrations/    # Historical migrations
```

## Database Schema

### Core Tables

#### Users (`users`)
**Purpose**: User authentication and profile management
```typescript
{
  id: string (UUID, primary key)
  email: string (unique, from OAuth)
  firstName: string (optional)
  lastName: string (optional) 
  profileImageUrl: string (from Replit profile)
  role: 'free' | 'pro' | 'enterprise' (subscription tier)
  stripeCustomerId: string (Stripe integration)
  stripeSubscriptionId: string (active subscription)
  createdAt: timestamp
  updatedAt: timestamp
}
```

#### Sessions (`sessions`) 
**Purpose**: Secure session storage for authentication
```typescript
{
  sid: string (session ID, primary key)
  sess: jsonb (session data)
  expire: timestamp (session expiration)
}
```

#### Jobs (`jobs`)
**Purpose**: Scraping and processing job queue
```typescript
{
  id: string (UUID, primary key)
  userId: string (foreign key to users)
  kind: 'scrape' | 'upload' | 'index' | 'chat' | 'visualise'
  status: 'queued' | 'running' | 'done' | 'fail'
  inputJson: jsonb (job configuration)
  outputJson: jsonb (job results)
  costCredits: number (credits consumed)
  progress: number (0-100 completion percentage)
  errorMessage: string (failure details)
  createdAt: timestamp
  updatedAt: timestamp
}
```

#### Knowledge Base Documents (`kb_docs`)
**Purpose**: Scraped content and uploaded documents for RAG
```typescript
{
  id: string (UUID, primary key)
  userId: string (foreign key to users)
  title: string (document title)
  content: text (full document content)
  docHash: string (unique content hash for deduplication)
  metaJson: jsonb (source URL, file info, etc.)
  embedding: vector(1536) (OpenAI embeddings for similarity search)
  createdAt: timestamp
}
```

#### Conversations (`conversations`)
**Purpose**: Chat conversation threading
```typescript
{
  id: string (UUID, primary key)  
  userId: string (foreign key to users)
  title: string (conversation title)
  docIds: string[] (array of document IDs for context)
  createdAt: timestamp
  updatedAt: timestamp
}
```

#### Messages (`messages`)
**Purpose**: Individual chat messages within conversations
```typescript
{
  id: string (UUID, primary key)
  conversationId: string (foreign key to conversations)
  role: 'user' | 'assistant'
  content: text (message content)
  metadata: jsonb (sources, tokens used, etc.)
  createdAt: timestamp
}
```

### Billing & Analytics Tables

#### Plans (`plans`)
**Purpose**: Subscription plan definitions
```typescript
{
  id: string (UUID, primary key)
  code: string (unique plan identifier)
  name: string (display name)
  pricesJson: jsonb ({ weekly: 14, monthly: 39, yearly: 390 })
  createdAt: timestamp
}
```

#### Subscriptions (`subscriptions`)
**Purpose**: User subscription tracking
```typescript
{
  id: string (UUID, primary key)
  userId: string (foreign key to users)
  stripeCustomerId: string (Stripe customer ID)
  stripeSubscriptionId: string (Stripe subscription ID)
  planCode: string (foreign key to plans.code)
  status: string (active, canceled, past_due, etc.)
  renewedAt: timestamp
  createdAt: timestamp
  updatedAt: timestamp
}
```

#### Credits Ledger (`credits_ledger`)
**Purpose**: Usage tracking and credit accounting
```typescript
{
  id: string (UUID, primary key)
  userId: string (foreign key to users)
  delta: number (positive for additions, negative for usage)
  reason: string (subscription_credit, scrape_usage, chat_usage, etc.)
  jobId: string (reference to related job)
  createdAt: timestamp
}
```

#### Audit Logs (`audit_logs`)
**Purpose**: Security and compliance tracking
```typescript
{
  id: string (UUID, primary key)
  actorId: string (foreign key to users)
  action: string (action performed)
  target: string (target resource)
  metaJson: jsonb (additional context)
  createdAt: timestamp
}
```

### Supporting Tables

#### Assets (`assets`)
**Purpose**: File storage metadata
```typescript
{
  id: string (UUID, primary key)
 

---
*This content was automatically extracted from ChatCrawler-Replit-version. For the most up-to-date information, refer to the source project.*
