---
title: "CLAUDE"
description: "ai-context for Back End Architecture for Turborepo with RAG Embeddings"
category: "ai-context"
project: "Back End Architecture for Turborepo with RAG Embeddings"
lastUpdated: "2025-09-21"
tags: "ai-context,main-platform"
---

# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a comprehensive backend intelligence architecture for LostMind AI, featuring RAG (Retrieval-Augmented Generation) capabilities with Google Generative AI embeddings, designed as a Python monorepo architecture. The system provides AI-powered services for document processing, Excel analysis, web scraping intelligence, and job discovery.

## Architecture

### Core Structure
- **Monorepo Architecture**: Organized packages with shared dependencies using Python path manipulation
- **Microservices Design**: Independent services communicating via FastAPI endpoints
- **Modern AI Integration**: Google Generative AI SDK (google-genai>=0.3.0) with latest models
- **Multi-Provider Vector Database**: Support for Pinecone, ChromaDB, and Weaviate

### Key Components
1. **API Gateway** (`apps/api-gateway/main.py`) - FastAPI application with authentication, rate limiting, and service orchestration
2. **Core Services** (`packages/core-services/`) - Embedding generation, vector operations, document processing, and configuration
3. **RAG Pipeline** (`packages/rag-pipeline/`) - Complete RAG implementation with conversation management
4. **Intelligence Modules** (`packages/analysis-modules/`) - Specialized AI services for Excel, web scraping, job discovery, and news
5. **Analysis Components** (`packages/analysis-components/`) - Utility analyzers for formulas, VBA, worksheets, and dashboards

## Development Commands

### Environment Setup
```bash
# Navigate to API Gateway and install dependencies
cd apps/api-gateway
pip install -r requirements.txt

# IMPORTANT: Ensure using modern google-genai package (not legacy google-generativeai)
pip install google-genai>=0.3.0

# Required environment variables
export GOOGLE_API_KEY=your_google_api_key
export GEMINI_API_KEY=your_google_api_key  # Alternative env var for genai.Client()
export VECTOR_DB_PROVIDER=pinecone  # or chromadb, weaviate
export VECTOR_DB_API_KEY=your_vector_db_key
export VECTOR_DB_ENVIRONMENT=us-east-1-aws
export VECTOR_DB_INDEX=lostmind-embeddings
```

### Running Services
```bash
# Start the main API Gateway (includes all services)
cd apps/api-gateway
python main.py

# Run specific analysis tools
cd tools/analysis-runners
python run_simple_analysis.py
python run_advanced_analysis.py  
python run_formula_intelligence.py
python run_relationship_analysis.py
python standalone_excel_analyzer.py
```

### Testing and Validation
```bash
# Validate configuration
cd packages/core-services
python config.py

# Health check all services
curl http://localhost:8000/health

# Check specific service health
curl http://localhost:8000/health/rag
curl http://localhost:8000/health/embedding
```

## Technical Implementation

### Python Monorepo Import Structure
The project uses path manipulation for cross-package imports:
```python
# From apps/api-gateway/main.py
import sys
import os
sys.path.append(os.path.join(os.path.dirname(__file__), '..', '..'))

from packages.rag_pipeline.rag_service import get_rag_service
from packages.core_services.embedding_service import get_embedding_service
```

### AI/ML Integration
- **Google GenAI SDK**: Version 0.3.0+ using modern `google-genai` package (not legacy `google-generativeai`)
- **Import Pattern**: `from google import genai` and `from google.genai import types`
- **Primary Models**: 
  - Embeddings: `text-embedding-004` (768 dimensions)
  - Generation: `gemini-2.5-flash`, `gemini-2.0-flash-exp`, `gemini-2.0-pro-exp`
- **RAG Pipeline**: Advanced retrieval with streaming responses and conversation history
- **Rate Limiting**: Configured per-service limits (30/min RAG, 50/min embeddings, 10/min ingestion)

### Service Communication
- **Synchronous**: REST APIs via FastAPI with Pydantic validation
- **Authentication**: JWT Bearer tokens (demo implementation in place)
- **Background Tasks**: FastAPI BackgroundTasks for usage logging
- **Health Monitoring**: Comprehensive health checks with service status aggregation

### Async Service Architecture
Services are initialized asynchronously in the API Gateway lifespan:
```python
@asynccontextmanager
async def lifespan(app: FastAPI):
    # Initialize all services
    services['rag'] = await get_rag_service()
    services['embedding'] = await get_embedding_service()
    # ... other services
    yield
    # Cleanup services with .cleanup() methods
```

## Key Service Files

### API Gateway (`apps/api-gateway/`)
- `main.py` - FastAPI application with all endpoints and middleware
- `requirements.txt` - Python dependencies including google-genai, fastapi, uvicorn

### Core Services (`packages/core-services/`)
- `embedding_service.py` - Google Generative AI embedding generation with caching
- `vector_db_service.py` - Multi-provider vector database operations (Pinecone/ChromaDB/Weaviate)
- `document_processing_service.py` - PDF, DOCX, Excel document parsing and chunking


---
*This content was automatically extracted from Back End Architecture for Turborepo with RAG Embeddings. For the most up-to-date information, refer to the source project.*
